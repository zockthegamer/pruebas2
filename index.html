<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Para Valery üíõ ‚Äî Un regalo de Josue</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg1:#fff0f5; --bg2:#ffe4b5; --accent:#ff69b4; --accent2:#ffb6c1;
      --gold:#FFD27D;
    }
    html,body{height:100%;margin:0;font-family:"Segoe UI",Tahoma,Arial;overflow:hidden;}
    body{
      display:flex;align-items:center;justify-content:center;
      background: linear-gradient(135deg,var(--bg1),var(--bg2));
      flex-direction:column;
    }
    .stage{position:relative;width:100%;height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;overflow-y:auto; padding: 20px;}
    #pregunta{font-size:28px;font-weight:700;color:#7b1f2d;text-align:center;}
    .controls{display:flex;gap:20px;align-items:center;justify-content:center;position:relative;}
    .btn{padding:14px 28px;border-radius:12px;border:none;font-size:20px;font-weight:800;cursor:pointer;
      box-shadow:0 8px 18px rgba(0,0,0,0.12);transition:all 220ms ease;user-select:none;}
    #si{background:linear-gradient(180deg,var(--accent),var(--accent2));color:white;transform:scale(1);}
    #no{background:#7f8c8d;color:white;position:absolute;left:60%;top:50%;transform:translate(-50%,-50%);}
    @keyframes latido {0%{transform:scale(1);}25%{transform:scale(1.25);}50%{transform:scale(1.08);}75%{transform:scale(1.34);}100%{transform:scale(1);}}
    .regalo{display:none;font-size:110px;cursor:pointer;z-index:50;}
    .flores{display:none;text-align:center;z-index:50;color:#b22222;}
    .mensaje{font-size:26px;margin-top:12px;font-weight:700;color:#b22222;}
    .extra{font-size:18px;color:#a64d2a;margin-top:6px;font-style:italic;}
    .poema{display:none;max-width:900px;text-align:center;padding:20px;border-radius:16px;
      background:rgba(255,255,255,0.6);box-shadow:0 8px 30px rgba(0,0,0,0.08);z-index:45;}
    .typewriter{font-size:20px;color:#6b0a1a;min-height:72px;}
    .photos{display:none;gap:10px;align-items:center;justify-content:center;z-index:45;flex-wrap:wrap;margin-top:20px; max-width: 90%;}
    .photo{width:100%;height:100%;border-radius:12px;object-fit:cover;} /* Ajustado para el wrapper */
    .contador{position:absolute;top:18px;left:18px;background:rgba(255,255,255,0.7);padding:8px 12px;border-radius:12px;font-weight:700;color:#8a1a2b;}
    .nombreFinal{display:none;position:fixed;bottom:24px;right:24px;padding:12px 18px;border-radius:999px;
      background:linear-gradient(90deg,#ffd6e8,#fff1f8);font-weight:900;color:#9c1642;animation:brillar 2.5s infinite;}
    @keyframes brillar{0%{filter:brightness(1)}50%{filter:brightness(1.3)}100%{filter:brightness(1)}}
    .corazon{position:absolute;font-size:20px;pointer-events:none;z-index:5;opacity:0.95;}
    canvas{position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:30;}
    .audioControl{position: absolute;top: 12px;right: 12px;z-index: 95;display: flex;flex-direction: column;align-items: flex-end;gap: 8px;padding: 6px;border-radius: 12px;background: rgba(255,255,255,0.02);}
    .song-selector {padding: 6px 10px;border-radius: 8px;border: 1px solid #ccc;background-color: white;font-weight: 600;cursor: pointer;font-size: 14px;color: #555;}
    .mutebtn{background:rgba(255,255,255,0.85);padding:8px;border-radius:10px;font-weight:800;cursor:pointer;user-select:none;}
    .volumeSlider{width:140px;opacity:0;pointer-events:none;transform: translateY(-6px);transition: opacity 0.28s ease, transform 0.28s ease;-webkit-appearance: none;}
    .volumeSlider.show{opacity:1;pointer-events:auto;transform: translateY(0);}
    .volumeSlider::-webkit-slider-runnable-track{height:6px;border-radius:6px;background:linear-gradient(90deg,#ff69b4,#ffd27d);}
    .volumeSlider::-webkit-slider-thumb{-webkit-appearance:none;width:14px;height:14px;border-radius:50%;background:white;box-shadow:0 1px 3px rgba(0,0,0,0.2);margin-top:-4px;}
    .volumeSlider::-moz-range-track{height:6px;border-radius:6px;background:linear-gradient(90deg,#ff69b4,#ffd27d);}
    .volumeSlider::-moz-range-thumb{width:14px;height:14px;border-radius:50%;background:white;box-shadow:0 1px 3px rgba(0,0,0,0.2);}
    .footerNote{position:fixed;bottom:8px;left:12px;color:#5b0b22;font-weight:700;opacity:0.85;}
    .lightbox {display: none;position: fixed;z-index: 9999;top: 0; left: 0; right: 0; bottom: 0;background: rgba(0,0,0,0.85);align-items: center;justify-content: center;}
    .lightbox-content {max-width: 90%;max-height: 85%;border-radius: 14px;box-shadow: 0 0 20px rgba(0,0,0,0.4);}
    .lightbox video {max-width: 90%;max-height: 85%;border-radius: 14px;}
    .lightbox-close {position: absolute;top: 20px; right: 30px;font-size: 32px;color: white;cursor: pointer;font-weight: bold;text-shadow: 0 2px 6px rgba(0,0,0,0.5);}
    .upload-container {display: none;margin-top: 20px;padding: 15px;background: rgba(255, 255, 255, 0.7);border-radius: 12px;z-index: 50;}
    #status-message {font-size: 14px;margin-top: 8px;color: #7b1f2d;font-weight: 600;}

    /* --- NUEVO: Estilos para el bot√≥n de subida personalizado --- */
    #upload-form {display: flex;align-items: center;gap: 12px;}
    #image-input {display: none;}
    .custom-upload-btn {display: inline-flex;align-items: center;gap: 8px;padding: 10px 20px;background: var(--accent);color: white;font-weight: 700;border-radius: 10px;cursor: pointer;transition: background-color 0.3s ease;font-size: 16px;}
    .custom-upload-btn:hover {background: #ff85c8;}
    .plus-icon {font-size: 22px;font-weight: bold;}
    .file-name {font-style: italic;color: #8a1a2b;font-weight: 500;}
    .upload-btn {padding: 10px 20px;font-size: 16px;background: #27ae60; border-radius: 10px; border:none; color:white; font-weight:700; cursor:pointer;}
    .upload-btn:hover {background: #2ecc71;}
    .upload-btn:disabled {background: #95a5a6; cursor: not-allowed;}
    
    /* --- NUEVO: Estilos para el bot√≥n de borrar en las fotos --- */
    .photo-wrapper {position: relative;width: 200px;height: 140px;border-radius: 12px;overflow: hidden;box-shadow: 0 6px 18px rgba(0,0,0,0.12);cursor: pointer;transition: transform 0.3s ease;}
    .photo-wrapper:hover {transform: scale(1.08);}
    .delete-btn {position: absolute;top: 6px;right: 6px;background: rgba(255, 0, 0, 0.7);color: white;border: none;border-radius: 50%;width: 28px;height: 28px;font-size: 16px;font-weight: bold;display: flex;align-items: center;justify-content: center;cursor: pointer;opacity: 0;pointer-events: none;transition: opacity 0.2s ease, background-color 0.2s ease;z-index: 10;}
    .photo-wrapper:hover .delete-btn {opacity: 1;pointer-events: auto;}
    .delete-btn:hover {background: rgba(255, 0, 0, 0.9);}

    @media (max-width:720px){
        #pregunta{font-size:20px}.btn{font-size:16px;padding:10px 16px;}
        .volumeSlider{width:100px;}
        .photo-wrapper{width:130px;height:90px;}
    }
  </style>
</head>
<body>
  <div class="contador" id="contador">D√≠as juntos: 0</div>
  <div id="audioControl" class="audioControl" aria-hidden="false">
    <div class="mutebtn" id="mutebtn">üîà M√∫sica: silenciada</div>
    <select id="songSelector" class="song-selector" aria-label="Seleccionar canci√≥n">
      <option value="viernes13.mp3">Viernes 13</option>
      <option value="jueves12.mp3">Princesa Ken-Y</option>
      <option value="miercoles11.mp3">Ponte LOKITA</option>
    </select>
    <input id="volumeSlider" class="volumeSlider" type="range" min="0" max="1" step="0.01" value="1" aria-label="Volumen">
  </div>
  <div class="stage" id="stage">
    <div id="pregunta">¬øQuieres abrir este regalo de tu novio Josue? üíù</div>
    <div class="controls">
      <button class="btn" id="si">S√≠ &lt;3</button>
      <button class="btn" id="no">No :(</button>
    </div>
    <div class="regalo" id="regalo">üéÅ</div>
    <div class="flores" id="flores">
      <div style="font-size:64px">üåªüå∑üåªüåπüåª</div>
      <div class="mensaje">Te amo mi amor Valery üíõ</div>
      <div class="extra">Eres mi todo. Gracias por existir üåπ</div>
    </div>
    <div class="poema" id="poema"><div class="typewriter" id="typewriter"></div></div>
    <div class="photos" id="photos"></div>
    
    <div class="upload-container" id="upload-container">
        <form id="upload-form">
            <input type="file" id="image-input" accept="image/*,video/*" required>
            <label for="image-input" class="custom-upload-btn">
                <span class="plus-icon">+</span> A√±adir
            </label>
            <span id="file-name" class="file-name"></span>
            <button type="submit" class="upload-btn" id="submit-btn" style="display: none;">Subir</button>
        </form>
        <div id="status-message"></div>
    </div>

    <div class="nombreFinal" id="nombreFinal">Valery üíõ</div>
    <div class="footerNote">Un detalle de Josue ‚Äî Hecho con ‚ô•</div>
  </div>
  <canvas id="confetti"></canvas>
  <audio id="bgMusic" loop></audio>
  <div class="lightbox" id="lightbox">
    <span class="lightbox-close" id="lightbox-close">&times;</span>
    <img id="lightbox-img" class="lightbox-content" />
    <video id="lightbox-video" controls loop></video>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCuCBarj_3H2FOe2FSEmRJ5FGynWZhjWu4",
      authDomain: "valky090725.firebaseapp.com",
      projectId: "valky090725",
      storageBucket: "valky090725.firebasestorage.app",
      messagingSenderId: "562892182179",
      appId: "1:562892182179:web:2a4658e2ebd2ee8d90a516",
      measurementId: "G-9BKRM3K7Q9"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();
  </script>

  <script>
  const relationshipStart = '2025-07-09';
  const poemLines = ["En tus ojos encontr√© mi amanecer,","en tu risa la canci√≥n que quiero aprender.","Eres mi calma y mi fuego a la vez,","Valery, por siempre te voy a querer.","Valery, te amo ‚ô• mi amor."];
  const photosEl = document.getElementById("photos");
  const uploadContainer = document.getElementById("upload-container");

  async function initPhotos(){
    photosEl.innerHTML = '';
    const snapshot = await db.collection("photos").orderBy("timestamp", "asc").get();
    
    snapshot.forEach(doc => {
      const item = doc.data();
      const docId = doc.id;
      
      const photoWrapper = document.createElement("div");
      photoWrapper.className = "photo-wrapper";

      const deleteBtn = document.createElement("button");
      deleteBtn.className = "delete-btn";
      deleteBtn.innerHTML = "üóëÔ∏è";
      deleteBtn.title = "Borrar recuerdo";
      deleteBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          if (confirm("¬øEst√°s seguro de que quieres borrar este recuerdo?")) {
              deletePhoto(docId, item.url);
          }
      });
      photoWrapper.appendChild(deleteBtn);

      if(item.type.startsWith("image")){
        const img=document.createElement("img");
        img.src=item.url; img.className="photo";
        img.alt="Recuerdo con Valery";
        img.addEventListener("click",()=>openLightbox("img",item.url));
        photoWrapper.appendChild(img);
      } else if(item.type.startsWith("video")){
        const vid=document.createElement("video");
        vid.src=item.url; vid.className="photo";
        vid.autoplay=true; vid.loop=true; vid.muted=true; vid.playsInline=true;
        vid.addEventListener("click",()=>openLightbox("video",item.url));
        photoWrapper.appendChild(vid);
      }
      photosEl.appendChild(photoWrapper);
    });
    photosEl.style.display="flex";
    uploadContainer.style.display="block";
  }

  async function deletePhoto(docId, fileUrl) {
      try {
          await db.collection("photos").doc(docId).delete();
          const fileRef = storage.refFromURL(fileUrl);
          await fileRef.delete();
          statusMessage.textContent = 'Recuerdo borrado con √©xito.';
          initPhotos();
      } catch (error) {
          console.error("Error al borrar el recuerdo: ", error);
          statusMessage.textContent = 'Hubo un error al borrar el recuerdo.';
      }
  }

  function updateDaysCounter(){
    const start=new Date(relationshipStart+"T00:00:00");
    const now=new Date();
    const diff=Math.floor((now-start)/(1000*60*60*24));
    document.getElementById("contador").textContent="D√≠as juntos: "+(diff>=0?diff:0);
  }
  updateDaysCounter();

  const si=document.getElementById("si"), no=document.getElementById("no"), regalo=document.getElementById("regalo"),
  pregunta=document.getElementById("pregunta"), flores=document.getElementById("flores"), poema=document.getElementById("poema"),
  typewriter=document.getElementById("typewriter"), nombreFinal=document.getElementById("nombreFinal");
  let clicks=0, siScale=1;
  no.addEventListener("mouseover",()=>{
    no.style.left=Math.random()*500+"px";
    no.style.top=Math.random()*300+"px";
    siScale += 0.15;
    si.style.transform=`scale(${siScale})`;
    si.style.animation="latido 0.8s ease-in-out";
  });
  si.addEventListener("click",()=>{
    pregunta.style.display="none";si.style.display="none";no.style.display="none";regalo.style.display="block";
  });
  regalo.addEventListener("click",()=>{
    clicks++;
    if(clicks===3){
      regalo.style.display="none";
      flores.style.display="block";
      showPoem();
      initPhotos();
      nombreFinal.style.display="block";
      launchFloatingHearts();
    }
  });
  function showPoem(){
    poema.style.display="block";
    let i=0;
    function typeLine(){
      if(i>=poemLines.length)return;
      let line=poemLines[i],j=0;
      let inter=setInterval(()=>{
        typewriter.textContent=line.slice(0,j+1);
        j++;
        if(j>=line.length){clearInterval(inter);i++;setTimeout(typeLine,700);} }
      ,50);
    }
    typeLine();
  }
  function launchFloatingHearts(){
    setInterval(()=>{
      const heart = document.createElement("div");
      heart.className = "corazon";
      heart.textContent = "üíñ";
      heart.style.left = Math.random()*window.innerWidth + "px";
      heart.style.bottom = "-20px";
      heart.style.position = "fixed";
      heart.style.fontSize = Math.random()*20+20 + "px";
      document.body.appendChild(heart);
      let y = -20;
      const anim = setInterval(()=>{
        y += 2;
        heart.style.bottom = y+"px";
        if(y > window.innerHeight+50){
          clearInterval(anim);
          heart.remove();
        }
      },30);
    },600);
  }
  const audioControl = document.getElementById("audioControl");
  const mutebtn = document.getElementById("mutebtn");
  const bgMusic = document.getElementById("bgMusic");
  const volumeSlider = document.getElementById("volumeSlider");
  const songSelector = document.getElementById("songSelector");
  let hideTimer = null;
  function clearHideTimer(){ if(hideTimer) { clearTimeout(hideTimer); hideTimer = null; } }
  function scheduleHide(ms = 1500){
    clearHideTimer();
    hideTimer = setTimeout(()=>{
      volumeSlider.classList.remove("show");
    }, ms);
  }
  function showSlider(){ clearHideTimer(); volumeSlider.classList.add("show"); }
  function hideSliderImmediate(){ clearHideTimer(); volumeSlider.classList.remove("show"); }
  window.addEventListener('load', () => {
    bgMusic.src = songSelector.value;
  });
  songSelector.addEventListener("change", (event) => {
    const newSong = event.target.value;
    bgMusic.src = newSong;
    bgMusic.load();
    bgMusic.play().catch(()=>{});
    mutebtn.textContent = "üîä M√∫sica: reproduciendo";
    showSlider();
    scheduleHide(3000);
  });
  mutebtn.addEventListener("click", () => {
    if (bgMusic.paused) {
      bgMusic.play().catch(()=>{});
      mutebtn.textContent = "üîä M√∫sica: reproduciendo";
      showSlider();
      scheduleHide(3000);
    } else {
      bgMusic.pause();
      mutebtn.textContent = "üîà M√∫sica: silenciada";
      hideSliderImmediate();
    }
  });
  bgMusic.addEventListener("play", ()=> {
    mutebtn.textContent = "üîä M√∫sica: reproduciendo";
  });
  bgMusic.addEventListener("pause", ()=> {
    mutebtn.textContent = "üîà M√∫sica: silenciada";
    hideSliderImmediate();
  });
  audioControl.addEventListener("mouseenter", () => {
    if (!bgMusic.paused) {
      showSlider();
    }
  });
  audioControl.addEventListener("mouseleave", () => {
    if (!bgMusic.paused) {
      scheduleHide(1200);
    }
  });
  volumeSlider.addEventListener("mouseenter", () => { clearHideTimer(); showSlider(); });
  volumeSlider.addEventListener("mouseleave", () => { if (!bgMusic.paused) scheduleHide(1200); });
  volumeSlider.addEventListener("input", () => {
    bgMusic.volume = parseFloat(volumeSlider.value);
});
  const lightbox=document.getElementById("lightbox");
  const lightboxImg=document.getElementById("lightbox-img");
  const lightboxVideo=document.getElementById("lightbox-video");
  const closeBtn=document.getElementById("lightbox-close");
  function openLightbox(type,src){
    lightbox.style.display="flex";
    if(type==="img"){
      lightboxImg.style.display="block";
      lightboxVideo.style.display="none";
      lightboxImg.src=src;
    } else {
      lightboxImg.style.display="none";
      lightboxVideo.style.display="block";
      lightboxVideo.src=src;
      lightboxVideo.play();
    }
  }
  closeBtn.addEventListener("click",()=>{
    lightbox.style.display="none";
    lightboxImg.src="";
    lightboxVideo.pause();
    lightboxVideo.src="";
  });
  lightbox.addEventListener("click",(e)=>{
    if(e.target===lightbox){
      closeBtn.click();
    }
  });

  const uploadForm = document.getElementById('upload-form');
  const imageInput = document.getElementById('image-input');
  const statusMessage = document.getElementById('status-message');
  const fileNameSpan = document.getElementById('file-name');
  const submitBtn = document.getElementById('submit-btn');

  imageInput.addEventListener('change', () => {
    if (imageInput.files.length > 0) {
        fileNameSpan.textContent = imageInput.files[0].name;
        submitBtn.style.display = 'inline-block';
        statusMessage.textContent = '';
    } else {
        fileNameSpan.textContent = '';
        submitBtn.style.display = 'none';
    }
  });

  uploadForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const file = imageInput.files[0];
    if (!file) return;

    statusMessage.textContent = 'Subiendo, un momento por favor...';
    submitBtn.disabled = true;

    try {
      const fileName = `${Date.now()}_${file.name}`;
      const storageRef = storage.ref(`photos/${fileName}`);
      
      const uploadTask = await storageRef.put(file);
      
      const imageUrl = await uploadTask.ref.getDownloadURL();
      
      await db.collection('photos').add({
        url: imageUrl,
        type: file.type,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      statusMessage.textContent = '¬°Recuerdo a√±adido con √©xito!';
      uploadForm.reset();
      fileNameSpan.textContent = '';
      submitBtn.style.display = 'none';
      submitBtn.disabled = false;
      initPhotos();

    } catch (error) {
      console.error("Error al subir el archivo: ", error);
      statusMessage.textContent = 'Hubo un error al subir el archivo.';
      submitBtn.disabled = false;
    }
  });
  </script>
</body>
</html>
